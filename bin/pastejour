#!/usr/bin/env ruby

require "pastejour/cli"

opts = Pastejour::Cli.new STDOUT, ARGV

if opts.run?
  if opts.list?
    Pastejour.list
  elsif $stdin.tty?
    name = /#{ENV["USER"]}$/ if opts.name.nil? || opts.name.empty?
    $stdout.write Pastejour.get(name)
    $stdout.flush
  else
    name = [ENV["USER"], opts.name].compact.join "-"
    contents = $stdin.read
    Pastejour.serve name, opts.multiple?, contents
    $stdout.puts contents if opts.tee?
  end
end
